TNZ=window.TNZ||{},TNZ.TravelDistanceCalculator=function(o){var i={};if(o.mapplatform=o.mapplatform||"GOOGLE",o.block_unique_id=o.block_unique_id||-1,!1==!!o.block_unique_id||-1===o.block_unique_id)throw new Error('Settings param "block_unique_id" is required. This is the HTML ID of the main content-block div');if(!1==!!o.map_holder_html_id||-1===o.map_holder_html_id)throw new Error('Settings param "map_holder_html_id" is required. This is the HTML ID of the div that will hold the map.');o.enabledirectionservice=null==o.enabledirectionservice||!0===o.enabledirectionservice,o.preserveDefaultStyles=!0,o.devicecontext=o.devicecontext||"desktop",o.dependentSourceFiles.iconspritesheet=o.dependentSourceFiles.iconspritesheet||"",o.dependentSourceFiles.iconfolder=o.dependentSourceFiles.iconfolder||"",o.endpoint=o.endpoint||{},o.endpoint.result=o.endpoint.result||{},o.endpoint.result.url=o.endpoint.result.url||"",o.endpoint.result.queryParamData=o.endpoint.result.queryParamData||{},o.endpoint.result.contentplacementid=o.endpoint.result.contentplacementid||"js-distance-calculator-result";var t=$("#"+o.block_unique_id);o.moduleholderid=o.block_unique_id,o.moduleuniqueid=o.block_unique_id,o.mapholderid="#"+o.map_holder_html_id,o.mapoptions=TNZ.MapUtil.getDefaultMapOptions(),i.oMap,i.$originDropdown=$("#calculator_start"),i.$destinationDropdown=$("#calculator_finish"),i.$transportModeDropdown=$("#calculator_mode"),i.$calculateDistanceBtn=t.find(".js-calculate-distance"),i.$calculateDistanceBtnTextDefault=i.$calculateDistanceBtn.find(".js-calc-distance-label"),i.$calculateDistanceBtnTextLoading=i.$calculateDistanceBtn.find(".js-calc-distance-loading-label"),i.$calculateDistanceResultPanel=$("#js-distance-calculator-result"),i.$calculateDistanceNoResultPanel=$("#js-distance-calculator-no-result"),i.$mapHolder=$("#"+o.map_holder_html_id),i.loadingClass="is-loading";var n=function(){o.mapoptions=o.mapoptions||TNZ.MapUtil.getDefaultMapOptions(),o.mapoptions.overviewMapControl=!p(),o.mapoptions.minZoom=p()?4:5,"GOOGLE"===o.mapplatform&&(o.mapoptions.styles=a(o.mapoptions.styles),o.mapoptions.zoom=o.mapoptions.zoom||5,o.mapoptions.center=o.mapoptions.center||new google.maps.LatLng(TNZ.MapCoreConfig.getDefaultCentre().lat,TNZ.MapCoreConfig.getDefaultCentre().lng),o.mapoptions.zoomControlOptions=o.mapoptions.zoomControlOptions||{position:google.maps.ControlPosition.TOP_RIGHT})},a=function(e){var t=$.extend(!0,[],e);for(var n in t)if("administrative.locality"==t[n].featureType){t[n].stylers[0].visibility="on";break}return t},l=function(){var t={loadoninit:!1,placement_id:o.endpoint.result.contentplacementid,endpoint:o.endpoint.result.url,placementtype:"insert",successCallBack:function(){g(),TNZ.JSLib.triggerLoadEvent("TNZ.TravelDistanceCalculator.DirectionResult.Loaded"+o.moduleuniqueid)},errorCallBack:function(){console.log("travel-distance-calculator,async content error",e)}};return new TNZ.AsyncContentBlock(t,o.endpoint.result.queryParamData,$)},r=function(){i.$calculateDistanceBtn.on("click",function(){c()}),TNZ.EventManager.bind("Map.Directions.Ready"+o.moduleuniqueid,function(e){s(e)}),TNZ.EventManager.bind("Map.Directions.Failed"+o.moduleuniqueid,function(e){u()}),TNZ.JSLib.requireLoadEvent(["TNZ.Map.Platform.Ready."+o.moduleuniqueid],function(){i.$mapHolder.removeClass("is-loading")})},d=function(){if(i.$originDropdown.length&&i.$destinationDropdown.length){var e=i.$originDropdown.find("option").not("[value='-1']").clone();i.$destinationDropdown.append(e),t.find(".js-chosen").chosen({disable_search_threshold:!1,width:"100%"})}},c=function(){var e=m();if(e.originLatLng!=e.destLatLng)if("-1"!=e.originLatLng&&"-1"!=e.destLatLng){f();var t={origin:e.originLatLng,destination:e.destLatLng,travelMode:e.transportMode};i.oMap.resetMap(),i.oMap.generateRouteFromAtoB(t)}else g();else g()},s=function(e){var t=m(),n={originLabel:t.originLabel,originNamekey:t.originNamekey,destLabel:t.destLabel,destNamekey:t.destNamekey,transportMode:t.transportMode,distance:e.distance,timetaken:e.timetaken,hasFerry:e.hasFerry,originLatLng:t.originLatLng,destLatLng:t.destLatLng},a={map_platform:o.mapplatform,calc_result_jsonpacket:JSON.stringify(n)};a=$.extend({},o.endpoint.result.queryParamData,a),i.$calculateDistanceResultPanel.html(""),i.AsyncContentBlock.loadContentBlock(a),i.$calculateDistanceNoResultPanel.attr("hidden",""),i.$calculateDistanceResultPanel[0].removeAttribute("hidden")},u=function(){g();var e=i.$calculateDistanceNoResultPanel.find(".js-calc-no-result-string"),t=e.text();e.html(t.replace("{start}",i.$originDropdown.find(":selected").text()).replace("{finish}",i.$destinationDropdown.find(":selected").text())),i.$calculateDistanceResultPanel.attr("hidden",""),i.$calculateDistanceNoResultPanel[0].removeAttribute("hidden")},p=function(){return TNZ.Device.isMobile()},m=function(){return{originLabel:i.$originDropdown.find("option:selected").text(),originNamekey:i.$originDropdown.find("option:selected").data("name_key")?i.$originDropdown.find("option:selected").data("name_key"):"",destLabel:i.$destinationDropdown.find("option:selected").text(),destNamekey:i.$destinationDropdown.find("option:selected").data("name_key")?i.$destinationDropdown.find("option:selected").data("name_key"):"",transportModeLabel:i.$transportModeDropdown.val(),originLatLng:i.$originDropdown.val(),destLatLng:i.$destinationDropdown.val(),transportMode:i.$transportModeDropdown.val()}},g=function(){i.$calculateDistanceBtn.removeAttr("style"),i.$calculateDistanceBtnTextLoading.attr("hidden",""),i.$calculateDistanceBtnTextDefault[0].removeAttribute("hidden"),i.$calculateDistanceBtn.removeClass(i.loadingClass)},f=function(){i.$calculateDistanceBtn.width(i.$calculateDistanceBtn.width()),i.$calculateDistanceBtnTextDefault.attr("hidden",""),i.$calculateDistanceBtnTextLoading[0].removeAttribute("hidden"),i.$calculateDistanceBtn.addClass(i.loadingClass)};i.AsyncContentBlock=l(),TNZ.MapUtil.setIconFolderLocation(o.dependentSourceFiles.iconfolder),n(),i.oMap=new TNZ.Map(o),d(),r()};