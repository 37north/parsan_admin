TNZ=window.TNZ||{},TNZ.SystemDeal=function(o,d,c){if(o=o||{},d=d||{},c=c||jQuery,!1==!!o.block_unique_id||0===o.block_unique_id.length)throw new Error('Settings param "block_unique_id" is required. This is the parent containing the deal html holder.');if(typeof o.bRemoveDealHolderDivIfNoDeal==typeof!0==!1)throw new Error('Settings param "bRemoveDealHolderDivIfNoDeal" is required. The needs to be a boolean value');if(o.bSwipeActive=o.bSwipeActive||!1,o.dealClassHook=o.dealClassHook||"js-systemdeal",o.dealDataEndPointAttribute=o.dealDataEndPointAttribute||"end_point_URL",!1==!!o.dealClassHook||0===o.dealClassHook.length)throw new Error('Settings param "dealClassHook" is required. It is the class used to find deal div containers. Defaults to "js-systemdeal"');if(!1==!!o.dealDataEndPointAttribute||0===o.dealDataEndPointAttribute.length)throw new Error('Settings param "dealDataEndPointAttribute" is required. It is the data attribute that contains the deal ID. Defaults to "end_point_URL"');var r={},p=function(e,t){var i=void 0===t||t,a=r.$noResultText.clone(!0)[0].removeAttribute("hidden");e.html(a),i&&e.find(".js-finddealsnearby-btn")[0].removeAttribute("hidden")},u=function(e){e.length&&e.remove()},w=function(e,t){var i,a,n,l=t.$htmlElement.attr("id");t.bSwipeActive&&1<t.$htmlElement.find(".deal").length&&TNZ.Device.isMediaQuery("<phablet")?r.swipeObject[l]||(i=t.$htmlElement,n=(a=i).attr("id"),a.wrapInner('<div class="swiper-wrapper o-slider__list" />').wrapInner('<div class="swiper-container o-slider--right-min-20" />'),a.find(".deal-wall__item").addClass("swiper-slide").addClass("o-slider__item"),a.find(".swiper-container").append('<div class="swiper-pagination o-slider__pagination o-slider__pagination--stack" />'),r.swipeObject[n]=new Swiper(a.find(".swiper-container"),{pagination:{el:".swiper-pagination",type:"bullets",clickable:!0,bulletActiveClass:"o-slider__bullet-active--secondary"},slidesPerView:"auto",paginationClickable:!0,spaceBetween:0,loop:!1,loopSlides:0}),h(i)):r.swipeObject[l]&&s(t.$htmlElement)},s=function(e){var t=e.attr("id");r.swipeObject[t].destroy(!0,!0),r.swipeObject[t]=void 0,$deals=e.find(".deal-wall__item"),$deals.removeClass("swiper-slide").removeClass("o-slider__item"),$deals.parent().hasClass("swiper-wrapper")&&$deals.unwrap(),$deals.parent().hasClass("swiper-container")&&$deals.unwrap(),e.find(".swiper-pagination").remove()},h=function(e){var i=e.data("renderertype")||"unknown";TNZ.JSLib.requireLoadEvent(["/thirdparty/hammer/hammer.min.js"],function(){e.find(".swiper-container").each(function(e,t){new Hammer(t).on("swipe",function(e){try{TNZ.DTM.setVar("renderertype",i),TNZ.DTM.track("block-deal-swipe")}catch(e){}})})})};return _init=function(){r.swipeObject=r.swipeObject||{};var e=c("#"+o.block_unique_id),t=e.find("."+o.dealClassHook);e.length&&(r.$noResultText=e.find(".js-noresultstext"),r.$noResultTextBtn=e.find(".js-finddealsnearby-btn"),t.each(function(){var e,i,a,n,l,t,r=c(this),s=r.data(o.dealDataEndPointAttribute);!0==!!s&&s.length&&(e=s,i=r,a=d,n=o.bSwipeActive,l=void 0!==a.lat,t=e,c.ajax({url:t,dataType:"json",type:"GET",data:a,cache:!0,success:function(e){if(i.length)if(e.success){if(i.html(e.value).fadeIn(),w({},{$htmlElement:i,bSwipeActive:n}),("wall"==a.renderer||"wallwithimage"==a.renderer)&&0===e.value.length)if(l){var t=i.find(".js-deal-item");t.length?t.fadeOut(1e3,function(){p(i)}):p(i,!1)}else p(i)}else o.bRemoveDealHolderDivIfNoDeal&&u(i)},error:function(e){console.log("_getDeals ERROR",e)}}))}),o.bSwipeActive&&1===t.length&&TNZ.EventManager.bind("TNZ.Resize.End",function(){w({},{$htmlElement:t,bSwipeActive:o.bSwipeActive})}))},_init(),{}};