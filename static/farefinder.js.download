TNZ=window.TNZ||{},TNZ.Farefinder=function(o,l){if((o=o||{block_unique_id:-1,isPatternLibTest:!1}).iframeclass=o.iframeclass||"js-iframe",o.selectoptionsclass=o.selectoptionsclass||"js-finderselectoptions",o.randomiseinitial=null!=o.randomiseinitial&&!1!=!!o.randomiseinitial,o.type=o.type||"bus",o.typemode=o.typemode||null,o.isincountry=typeof o.isincountry==typeof!0==!0?o.isincountry:null,o.showdropdown=typeof o.showdropdown==typeof!0!=!0||o.showdropdown,!1==!!o.block_unique_id||-1===o.block_unique_id)throw new Error('Settings param "block_unique_id" is required.');if("airline"===o.type){if(null==o.typemode||-1==["auto","international","domestic"].indexOf(o.typemode))throw new Error('Settings param "typemode" is required when type is "airline". This should be "auto"|"international"|"domestic"');if(null==o.market)throw new Error('Settings param "market" is required when type is "airline". eg: "gb","nl","de","fr","en" etc. Used for airline iframe defaultsizes for specific markets if no size supplied on <option> tag.');if("auto"===o.typemode&&(null==o.isincountry||typeof o.isincountry==typeof!0==!1))throw new Error('Settings param "isincountry" is required when type is "airline". This should be true|false (boolean value)')}var d={$block:(l=l||jQuery)("#"+o.block_unique_id),intOrDomesticAirlineType:null};if(d.$iframe=d.$block.find("."+o.iframeclass),d.$select=d.$block.find("."+o.selectoptionsclass),"airline"===o.type&&("auto"==o.typemode?d.intOrDomesticAirlineType=o.isincountry?"domestic":"international":d.intOrDomesticAirlineType=o.typemode,o.isPatternLibTest)){var e=l("#pl_finder_testdata").data("market");e&&(o.market=e)}var h=function(){return d.$select.find("option").filter(function(){return this.hasAttribute("value")&&"-1"!=this.value}).map(function(){var e=this.hasAttribute("data-weighting")&&0<this.getAttribute("data-weighting").length?this.getAttribute("data-weighting"):1,t=this.hasAttribute("data-type")&&0<this.getAttribute("data-type").length?this.getAttribute("data-type"):"international",i=this.getAttribute("data-width")&&0<this.getAttribute("data-width").length?this.getAttribute("data-width"):0,r=this.getAttribute("data-height")&&0<this.getAttribute("data-height").length?this.getAttribute("data-height"):0;if("airline"===o.type&&(0===i||0===r)){var n=function(e,t){var i={height:225,width:210};switch(e){case"bus":break;case"campervan":i.height=220,i.width=210;break;case"ferry":i.height=290,i.width=220;break;case"airline":i.height=213,i.width=164,(-1!=t.indexOf("tam")||-1!=t.indexOf("airnz")||-1!=t.indexOf("thaiairways")||-1!=t.indexOf("united")&&"us"==o.market||-1!=t.indexOf("hawaiianairlines")&&"us"==o.market||-1!=t.indexOf("qantas")||-1!=t.indexOf("garudaairlines")&&"id"==o.market||-1!=t.indexOf("koreanair")&&0<=["gb","nl","de","fr"].indexOf(o.market)||-1!=t.indexOf("emirates")&&0<=["gb","au","de","ie"].indexOf(o.market)||-1!=t.indexOf("pal"))&&(i.height=225,i.width=200),-1!=t.indexOf("qatarairways")&&0<=["de","gb"].indexOf(o.market)&&(i.height=260,i.width=200)}return i}(o.type,this.value);i=n.width,r=n.height,this.setAttribute("data-width",i),this.setAttribute("data-height",r)}return{url:this.value,width:i,height:r,weighting:e,type:t}}).get()},u=function(){var e={url:null,width:null,height:null,name_key:null},t=d.$select.find('option:not([value="-1"]):selected');if(0===t.length&&0===(t=d.$select.find('option:not([value="-1"]):first')).length)throw new Error("There are no valid farefinder options to display. Developer note: Check the farefinder script settings and HTML <options>. Ensure there are valid <options> elements to pick from.");return t.attr("value")&&"-1"!==t.val()&&(e.url=t.val()),e.width=t.attr("data-width"),e.height=t.attr("data-height"),e.name_key=t.attr("data-name_key"),e},f=function(e){e.url&&d.$iframe.length&&(d.$iframe.attr("width",e.width).attr("height",e.height),d.$iframe.attr("src",e.url))},c=function(){d.$select.chosen("destroy"),d.$select.attr("hidden",!0),d.$select.remove()};return function(){var e,t,i,r;if("airline"===o.type&&(e=d.intOrDomesticAirlineType,d.$select.find("option").filter(function(){return this.hasAttribute("data-type")&&this.getAttribute("data-type")!=e}).map(function(){l(this).remove()})),d.aOptions=h(),o.randomiseinitial){if(!(0<d.aOptions.length))throw new Error('There were no "'+d.intOrDomesticAirlineType+'" options supplied. Please add "'+d.intOrDomesticAirlineType+'" options or specify the "typemode" to NOT be "auto". Your in NZ status is: '+o.isincountry);var n=(r=d.aOptions,arr=[],r.map(function(e){for(var t=0;t<e.weighting;t++)arr.push(e)}),arr),a=(t=0,i=n.length-1,Math.floor(Math.random()*(i-t+1))+t);f(n[a])}else{var s=u();s.url&&"-1"!=s.url&&f(s)}d.aOptions.length<=1?d.$select.length&&c():!1===o.showdropdown&&c(),d.$select.on("change",function(e){e.preventDefault();var t=u();if(t.url&&"-1"!==t.url){f(t);try{t.name_key&&("airline"===o.type&&(TNZ.DTM.setVar("block-farefinderSelectedAirline",t.name_key),TNZ.DTM.track("block-farefinder-airline-select-change")),"campervan"===o.type&&(TNZ.DTM.setVar("block-farefinderSelectedCampervan",t.name_key),TNZ.DTM.track("block-farefinder-campervan-select-change")))}catch(e){}}})}(),{}};