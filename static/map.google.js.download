TNZ=window.TNZ||{},TNZ.MapUtil=function(o){(o=o||{}).clientid="gme-newzealandtourism",o.callback="TNZ.MapUtil.callBackHandler",o.region="NZ",o.langMarket=TNZ.initialRequestConfig.languageMarket||"en",o.enviroType=TNZ.initialRequestConfig.environmentType||"p",o.libraries="places",o.infocardoverlayrequested=!1,o.labeloverlayrequested=!1,o.htmlmarkeroverlayrequested=!1,o.markerclustererrequested=!1,o.iconspritesheetset=!1,o.iconfolderset=!1;var l={googleMapVersion:"3.33"},n={};l.defaultThresholdSettingArray=[{styles:[{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#616f68"},{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#ffffff"}]},{featureType:"landscape",elementType:"labels.text.fill",stylers:[{color:"#616f68"},{visibility:"off"}]},{featureType:"landscape",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#ffffff"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{saturation:"50"},{lightness:"-8"},{gamma:"1.5"},{hue:"#8bff00"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{hue:"#8bff00"},{saturation:"50"},{lightness:"-8"},{gamma:"1.5"}]},{featureType:"landscape.natural.landcover",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.terrain",elementType:"geometry",stylers:[{visibility:"on"},{lightness:"30"},{saturation:"0"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#a8d46f"},{lightness:"45"},{saturation:"15"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{visibility:"off"},{color:"#616f68"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#ffffff"}]},{featureType:"poi.school",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffdc68"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{lightness:"0"},{color:"#ffdc68"},{saturation:"-30"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ffdc68"},{gamma:"1.00"},{lightness:"0"},{saturation:"0"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{lightness:"20"},{visibility:"on"},{saturation:"0"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#94d5f7"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#616f68"},{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station.airport",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{visibility:"off"}]}]},{styles:[{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#616f68"},{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#ffffff"}]},{featureType:"landscape",elementType:"labels.text.fill",stylers:[{color:"#616f68"},{visibility:"off"}]},{featureType:"landscape",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#ffffff"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{saturation:"50"},{lightness:"-8"},{gamma:"1.5"},{hue:"#8bff00"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{hue:"#8bff00"},{saturation:"50"},{lightness:"-8"},{gamma:"1.5"}]},{featureType:"landscape.natural.landcover",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.terrain",elementType:"geometry",stylers:[{visibility:"on"},{lightness:"30"},{saturation:"0"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#a8d46f"},{lightness:"45"},{saturation:"15"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{visibility:"off"},{color:"#616f68"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#ffffff"}]},{featureType:"poi.school",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffdc68"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{lightness:"0"},{color:"#ffdc68"},{saturation:"-30"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ffdc68"},{gamma:"1.00"},{lightness:"0"},{saturation:"0"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{lightness:"20"},{visibility:"on"},{saturation:"0"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#94d5f7"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#616f68"},{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station.airport",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{visibility:"off"}]}]},{styles:[{featureType:"administrative",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#616f68"},{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#ffffff"}]},{featureType:"landscape",elementType:"labels.text.fill",stylers:[{color:"#616f68"},{visibility:"off"}]},{featureType:"landscape",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#ffffff"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{saturation:"50"},{lightness:"-8"},{gamma:"1.5"},{hue:"#8bff00"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{hue:"#8bff00"},{saturation:"50"},{lightness:"-8"},{gamma:"1.5"}]},{featureType:"landscape.natural.landcover",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.terrain",elementType:"geometry",stylers:[{visibility:"on"},{lightness:"30"},{saturation:"0"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#a8d46f"},{lightness:"45"},{saturation:"15"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{visibility:"off"},{color:"#616f68"}]},{featureType:"poi",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#ffffff"}]},{featureType:"poi.school",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffdc68"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{lightness:"0"},{color:"#ffdc68"},{saturation:"-30"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ffdc68"},{gamma:"1.00"},{lightness:"0"},{saturation:"0"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{lightness:"20"},{visibility:"on"},{saturation:"0"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#94d5f7"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#616f68"},{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"transit.station.airport",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{visibility:"off"}]}]}],l.iconList="abseiling-rappelling,accommodation,air-activities,airport,arts-and-crafts,attractions,beach,bird-watching,boating,bungy,canyoning,car,casinos,caving,circle,climbing,cycling,default,diving,dolphins,farm,fishing,galleries,garden,glider-planes,golf,heliskiing,heritage-attractions,hiking,hobbiton,holiday-park,horse-treks,hot-air-ballooning,hot-pools-and-health-spas,hotspring,hunting,island,jetboat,kayaking,landscape,maori,marine,miscellaneous-madness,motorcycling,mountain-biking,museum,nature,off-road-driving,orienteering,paragliding-and-hang-gliding,parasailing,park,penguin,performing-arts,photography,rafting,rock-climbing,sailing,scenic-flights,scenic-hightlight,seals,sightseeing,ski,skydiving,snowboarding,sports,star,stargazing,study-education,surf,swim,theme-and-leisure-parks,trails,transport,travel-agent,urban-and-scenic-attractions,visitor,volcano,weddings,whale-watching,wildlife-encounters,windsurf,winery,zip-lining,zoo".split(","),l.iconStateTypeLookup={normal:1,hover:0,selected:0},l.spritesheetFile="",l.iconFolder="";n.callBackHandler=function(){TNZ.JSLib.triggerLoadEvent("TNZ.Map.MapLibrary.Ready",{mapplatform:"GOOGLE"})},n.getDefaultMapOptions=function(){return{maxZoom:16,keyboardShortcuts:!1,mapTypeControl:!1,panControl:!1,scaleControl:!1,streetViewControl:!0,rotateControl:!1,scrollwheel:!1,overviewMapControl:!1,overviewMapControlOptions:{opened:!0},styles:n.getStyleThresholdSettingArray()[1].styles,zoomControl:!0,gestureHandling:"cooperative"}},n.getDefaultPolylineOptions=function(){return{strokeColor:"grey",strokeHoverColor:"#339999",strokeWeight:"4",strokeOpacity:.9,selected:!1,zIndex:100}},n.getDefaultMarkerClusterOptions=function(){return{styles:[{height:44,url:TNZ.MapUtil.getIconImageFromFile("cluster"),textColor:"#FFF",width:44,textSize:16,fontFamily:"National, Archer A,Archer B",fontWeight:600}],minimumClusterSize:2,maxZoom:18}},n.loadInfocardOverlayJSFile=function(e){if(!o.infocardoverlayrequested){e=e||"overlay.infocard.js";TNZ.JSLib.loadScript(e,"/blocks/map/overlay.infocard.js"),o.infocardoverlayrequested=!0}},n.loadLabelOverlayJSFile=function(e){if(!o.labeloverlayrequested){e=e||"overlay.label.js";TNZ.JSLib.loadScript(e,"/blocks/map/overlay.label.js"),o.labeloverlayrequested=!0}},n.loadHTMLMarkerOverlayJSFile=function(e){if(!o.htmlmarkeroverlayrequested){e=e||"overlay.htmlmarker.js";TNZ.JSLib.loadScript(e,"/blocks/map/overlay.htmlmarker.js"),o.htmlmarkeroverlayrequested=!0}},n.loadMarkerClustererJSFile=function(e){if(!o.markerclustererrequested){e=e||"/dist/js/thirdparty/markerclustererplus/markerclusterer.js";TNZ.JSLib.loadScript(e,"/thirdparty/markerclustererplus/markerclusterer.js"),o.markerclustererrequested=!0}},n.getStyleThresholdSettingArray=function(){return l.defaultThresholdSettingArray},n.setIconSpritesheetFile=function(e){o.iconspritesheetset||(l.spritesheetFile=e,o.iconspritesheetset=!0)},n.setIconFolderLocation=function(e){o.iconfolderset||(l.iconFolder=e,o.iconfolderset=!0)},n.getIconSpritesheetFile=function(){return l.spritesheetFile},n.getIconImageFromSprite=function(e,t,r){r=r||"";var o=i(e),l=s(t),a=n.getIconSpritesheetFile();return""!=r&&(a=a.replace(".png","-"+r+".png")),{url:a,origin:new google.maps.Point(30*o,40*l),size:new google.maps.Size(30,40)}},n.getIconImageFromFile=function(e){return l.iconFolder+"custommarkers/"+e+".png"},n.getMarkerIconImageFromFile=function(e){return l.iconFolder+"markericon/"+e+".png"},n.getLeftMostMarker=function(e,t){for(var r,o=9999,l=t||e.getAllActivityMarkerObj(),a=0;a<l.length;a++){var n=l[a],i=u(e,n);n.leftpixpos=i.x,i.x<o&&(o=i.x,r=n)}return r},n.getRightMostMarker=function(e,t){for(var r,o=0,l=t||e.getAllActivityMarkerObj(),a=0;a<l.length;a++){var n=l[a],i=u(e,n);n.rightpixpos=i.x,i.x>o&&(o=i.x,r=n)}return r},n.getPixelPosOfMarker=function(e,t){return u(e,t)},n.getNewMarkerPosAfterOffset=function(e,t,r,o){var l=e.getProjection().fromLatLngToPoint(t instanceof google.maps.LatLng?t:e.getCenter()()),a=new google.maps.Point(("number"==typeof r?r:0)/Math.pow(2,e.getZoom())||0,("number"==typeof o?o:0)/Math.pow(2,e.getZoom())||0);return e.getProjection().fromPointToLatLng(new google.maps.Point(l.x-a.x,l.y+a.y))},n.canTrackClick=function(e){e=e||{};return 0<Object.keys(e).length};var i=function(e){return l.iconStateTypeLookup[e]||0},s=function(e){var t=function(){for(var e={},t=l.iconList.length;t--;)e[l.iconList[t]]=t;return e}();return void 0===t[e]?t.default:t[e]},u=function(e,t){var r=Math.pow(2,e.getZoom()),o=new google.maps.LatLng(e.getBounds().getNorthEast().lat(),e.getBounds().getSouthWest().lng()),l=e.getProjection().fromLatLngToPoint(o),a=e.getProjection().fromLatLngToPoint(t.getPosition());return new google.maps.Point(Math.floor((a.x-l.x)*r),Math.floor((a.y-l.y)*r))};return function(){var e=o.langMarket,t=o.libraries;switch(e){case"cn":e="zh-CN";break;case"jp":e="ja";break;case"pt":e="pt-BR";break;case"kr":e="ko"}var r=document.createElement("script");r.type="text/javascript",r.src="https://maps.googleapis.com/maps/api/js?v="+l.googleMapVersion+"&client="+o.clientid+"&region="+o.region+"&callback="+o.callback+"&language="+e+"&libraries="+t,document.body.appendChild(r)}(),n}(),TNZ.Map=function(T,O){T=T||{},O=O||jQuery,T.enabledirectionservice=T.enabledirectionservice||!1,T.enableelevationservice=T.enableelevationservice||!1,T.enablemarkerclusterer=T.enablemarkerclusterer||!1,T.enabledistancematrixservice=T.enabledistancematrixservice||!1,T.enableplacesapi=T.enableplacesapi||!1,T.preserveDefaultStyles=T.preserveDefaultStyles||!1,T.showcurrentlocation=T.showcurrentlocation||!1,T.overlayrenderer=T.overlayrenderer||{},T.overlayrenderer.renderMethodArgs=T.overlayrenderer.renderMethodArgs||{},T.infocard=T.infocard||{},T.infocard.onclose=T.infocard.onclose||"",T.overlaycircle=T.overlaycircle||{},T.overlaycircle.display=T.overlaycircle.display||!1,T.overlaycircle.radius=T.overlaycircle.radius||4e4,T.overlaycircle.fillColor=T.overlaycircle.fillColor||"#65b319",T.overlaycircle.fillOpacity=T.overlaycircle.fillOpacity||0,T.overlaycircle.strokeWeight=T.overlaycircle.strokeWeight||2,T.overlaycircle.strokeColor=T.overlaycircle.strokeColor||"#65b319",T.overlaycircle.strokeOpacity=T.overlaycircle.strokeOpacity||.8,T.overlaycircle.tracktomapcenter=T.overlaycircle.tracktomapcenter||!1,T.overlaycircle.clickable=T.overlaycircle.clickable||!1;var C,r,a,b,e,t,o,l,n,I=this,A={},j=null;A.aAllActMarkerObj=[],A.aAllGroupMarkerObj=[],A.aAllTownMarkerObj=[],A.aAllLabelObj=[],A.aAllHTMLMarkerObj=[],A.aAllItinMarkerID=[],A.luAllItinMarkerObj=[],A.aAllPolylineID=[],A.luAllPolylineObj=[],A.aAllLatLngObj=[],A.oAllCustomRouteObj={},A.currentStyleSet=1,A.currentLocationMarkerObj=null,A.aInfoCard=[],A.oPolylineOptions=TNZ.MapUtil.getDefaultPolylineOptions(),A.currentLocationOverlayCircle=null;I.getInfoCardRenderMethodArgs=function(){return T.overlayrenderer.renderMethodArgs},I.resetMap=function(){I.removeLabels(),I.removeHTMLMarkers(),I.removeCurrentUserLocationMarkerPin(),I.removeTownMarkerPins(),I.removeActivityMarkerPins(),I.removeGroupMarkerPins(),I.removePolylines(),I.removeItineraryMarkers(),I.clearMarkerClusters(),I.removeCustomRoutes(),I.resetBound(),I.removeInfoCards(),I.removeCurrentLocationOverlayCircle(),TNZ.EventManager.trigger("TNZ.Map.reset"+T.moduleuniqueid,{module_id:T.moduleuniqueid})},I.addCurrentUserLocationMarkerPin=function(e,t){I.removeCurrentUserLocationMarkerPin(),TNZ.MapUtil.loadHTMLMarkerOverlayJSFile(T.dependentSourceFiles.overlayhtmlmarker);var r=_(e,t),o={customcssclass:"js-you-are-here",show_from_zoom_level:2};TNZ.JSLib.requireLoadEvent(["/blocks/map/overlay.htmlmarker.js"],function(){var e=new Overlay.HTMLMarker(r,'<div class="geolocation-dot"><div class="geo-centraldot"></div><div class="wave"></div></div>',o);(A.currentLocationMarkerObj=e).setMap(C)}),T.overlaycircle.display&&0==!!A.currentLocationOverlayCircle&&(A.currentLocationOverlayCircle=I.addCircleAtLocation(e,t))},I.addCircleAtLocation=function(e,t,r){r=r||{},r=O.extend({},T.overlaycircle,r);var o=_(e,t);return new google.maps.Circle({map:C,radius:r.radius,fillColor:r.fillColor,fillOpacity:r.fillOpacity,strokeWeight:r.strokeWeight,strokeColor:r.strokeColor,strokeOpacity:r.strokeOpacity,center:o,clickable:r.clickable})},I.removeCurrentLocationOverlayCircle=function(){A.currentLocationOverlayCircle&&(I.removeOverlayCircle(A.currentLocationOverlayCircle),A.currentLocationOverlayCircle=null)},I.removeOverlayCircle=function(e){e.setMap(null)},I.renderCard=function(e,t,r,o,l){e=e||!1,r=r||-1,o=o||"",l=l||!1;if(t=t||!1)if(e){var a=t.hasOwnProperty("getPosition_")?t.getPosition_():t.getPosition();(j=new Overlay.InfoCard(a,O(T.mapholderid),void 0,void 0,{unique_id:r,module_id:T.moduleuniqueid,overlap_pan:l,overlay_url:o})).setMap(C),A.aInfoCard.push(j)}else I.renderNativeInfoWindow(t.getPosition_(),o)},I.addActivityMarkerPin=function(e,t,r){var o=(r=r||{}).icon_namekey||"default",l=r.icon_image_override||"",a=r.unique_id||"-1",n=r.name_key||"",i=r.show_infocard_overlay||!1,s=r.overlay_url||"",u=r.overlap_pan||!1,c=r.draggable||!1,d=r.theme||"",p=r.htmlcontent||"",y=r.extendedData||{};y.pin_type=y.pin_type||"listing",y.map_type=y.map_type||"spotlight",P()||(u=!1);var f=_(e,t),g=TNZ.MapUtil.getIconImageFromSprite("normal",o,d);l.length&&(g=l);var m={position:f,icon:g,clickable:"-1"!=a,zIndex:199,selected:!1,iconnamekey:o,uniqueid:a,namekey:n,draggable:c,extendedData:y,theme:d},v=new google.maps.Marker(m);"-1"!==a&&(google.maps.event.addListener(v,"click",function(e){I.unselectObjectsOnMap(),w(),i?((j=p.length?new Overlay.InfoCardWithContent(f,O(T.mapholderid),p,{unique_id:a,module_id:T.moduleuniqueid,overlap_pan:u}):new Overlay.InfoCard(f,O(T.mapholderid),void 0,void 0,{unique_id:a,module_id:T.moduleuniqueid,overlap_pan:u,overlay_url:s})).setMap(C),A.aInfoCard.push(j)):p.length?I.renderNativeInfoWindowWithContent(f,p):I.renderNativeInfoWindow(f,s),v.setZIndex(200),g=TNZ.MapUtil.getIconImageFromSprite("selected",o,d),v.setIcon(g),v.selected=!0,TNZ.MapUtil.canTrackClick(e)&&(TNZ.EventManager.trigger("TNZ.Map.PinClicked"+T.moduleuniqueid,{unique_id:a,name_key:n}),TNZ.EventManager.trigger("TNZ.Map.ElementClicked",{data:this.extendedData,moduleuniqueid:T.moduleuniqueid}))}),google.maps.event.addListener(v,"mouseout",function(){v.selected||(g=TNZ.MapUtil.getIconImageFromSprite("normal",o,d),v.setZIndex(199),v.setIcon(g))}),google.maps.event.addListener(v,"mouseover",function(){v.selected||(g=TNZ.MapUtil.getIconImageFromSprite("hover",o,d),v.setZIndex(201),v.setIcon(g))})),A.aAllActMarkerObj.push(v),T.enablemarkerclusterer?b.addMarker(v):v.setMap(C)},I.addGroupMarkerPin=function(e,t,r){var o=(r=r||{}).icon_namekey||"grouping",l=r.unique_id||[],a=r.name_key||[],n=r.show_infocard_overlay||!1,i=r.overlay_url||"",s=r.overlap_pan||!1,u=r.extendedData||{};u.element_type=u.element_type||"multipin",u.pin_type=u.pin_type||"multiple",u.map_type=u.map_type||"spotlight",P()||(s=!1);var c=_(e,t),d=TNZ.MapUtil.getIconImageFromFile(o),p=l.join(","),y=a.join(","),f={position:c,icon:d,clickable:0!=l.length,zIndex:199,selected:!1,iconnamekey:o,uniqueid:p,extendedData:u,namekey:y},g=new google.maps.Marker(f);0<l.length&&(google.maps.event.addListener(g,"click",function(e){I.unselectObjectsOnMap(),w(),n?((j=new Overlay.InfoCard(c,O(T.mapholderid),void 0,void 0,{unique_id:p,module_id:T.moduleuniqueid,overlap_pan:s,overlay_url:i})).setMap(C),A.aInfoCard.push(j)):I.renderNativeInfoWindow(c,i),g.setZIndex(200),d=TNZ.MapUtil.getIconImageFromFile(o+"-selected"),g.setIcon(d),g.selected=!0,TNZ.MapUtil.canTrackClick(e)&&(TNZ.EventManager.trigger("TNZ.Map.PinClicked"+T.moduleuniqueid,{unique_id:l,name_key:a}),TNZ.EventManager.trigger("TNZ.Map.ElementClicked",{data:this.extendedData,moduleuniqueid:T.moduleuniqueid}))}),google.maps.event.addListener(g,"mouseout",function(){g.selected||(d=TNZ.MapUtil.getIconImageFromFile(o),g.setZIndex(199),g.setIcon(d))}),google.maps.event.addListener(g,"mouseover",function(){g.selected||(d=TNZ.MapUtil.getIconImageFromFile(o+"-selected"),g.setZIndex(201),g.setIcon(d))})),A.aAllGroupMarkerObj.push(g),T.enablemarkerclusterer?b.addMarker(g):g.setMap(C)},I.addTownMarkerPin=function(e,t,r){(r=r||{}).icon_namekey;var o=r.unique_id||"-1",l=r.show_infocard_overlay||!1,a=r.overlay_url||"",n=decodeURIComponent(r.href)||"",i=(r.overlap_pan,r.extendedData||{});i.pin_type=i.pin_type||"town",i.map_type=i.map_type||"spotlight",P();var s=_(e,t),u={url:TNZ.MapUtil.getIconImageFromFile("town"),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(16,16),size:new google.maps.Size(30,30)},c={position:s,icon:u,zIndex:100,extendedData:i,uniqueid:o},d=new google.maps.Marker(c);"-1"!==o&&google.maps.event.addListener(d,"click",function(){P()&&(w(),l?((j=new Overlay.InfoCard(s,O(T.mapholderid),void 0,void 0,{unique_id:o,module_id:T.moduleuniqueid,overlay_url:a})).setMap(C),A.aInfoCard.push(j)):n.length&&(location.href=n))}),A.aAllTownMarkerObj.push(d),d.setMap(C)},I.addLabel=function(e,t,r,o){r=decodeURIComponent(r),(o=o||{}).unique_id;var l=o.custom_class||"",a=decodeURIComponent(o.href)||"",n=o.offset||-18,i=o.show_from_zoom_level||8,s=_(e,t),u={customcssclass:l,offset:n,show_from_zoom_level:i},c=new Overlay.LabelMarker(s,r,a,u);A.aAllLabelObj.push(c),c.setMap(C)},I.addHTMLMarker=function(e,t,r,o){TNZ.MapUtil.loadHTMLMarkerOverlayJSFile(T.dependentSourceFiles.overlayhtmlmarker);(o=o||{}).unique_id;var l=o.custom_class||"",a=o.show_from_zoom_level||2,n=_(e,t),i={customcssclass:l,show_from_zoom_level:a};TNZ.JSLib.requireLoadEvent(["/blocks/map/overlay.htmlmarker.js"],function(){var e=new Overlay.HTMLMarker(n,r,i);A.aAllLabelObj.push(e),e.setMap(C)})},I.addCustomRouteMarkerPin=function(l,a,n,e){var i=(e=e||{}).unique_id||"-1",s=e.name_key||"",u=e.show_infocard_overlay||!1,c=e.overlay_url||"",d=e.overlap_pan||!1,p=(e.draggable,e.theme,e.icon_label||""),y=e.customcssclass||"custom-route-pin",f=e.svg||"",g=e.width||20,m=e.height||20,v=e.offsetLeft||0,b=e.offsetTop||0,k=e.extendedData||{};k.pin_type=k.pin_type||"custom-route",k.map_type=k.map_type||"spotlight";var M=void 0===e.visible||e.visible,h="-1"!=i;"undefined"!=e.clickable&&(h=e.clickable),TNZ.MapUtil.loadHTMLMarkerOverlayJSFile(T.dependentSourceFiles.overlayhtmlmarker),TNZ.JSLib.requireLoadEvent(["/blocks/map/overlay.htmlmarker.js"],function(){P()||(d=!1);var t=_(a,n),e={customcssclass:y+" js-custom-route-pin",show_from_zoom_level:2,visible:M,extendedData:k,clickable:h};if(""==f)var r="<div>"+p+"</div>";else r=f.replace("[[icon_label]]",p);var o=new Overlay.HTMLMarker(t,r,e,g,m,v,b);"-1"!==i&&(google.maps.event.addListener(o,"click",function(e){I.unselectObjectsOnMap(),w(),u?((j=new Overlay.InfoCard(t,O(T.mapholderid),void 0,void 0,{unique_id:i,module_id:T.moduleuniqueid,overlap_pan:d,overlay_url:c})).setMap(C),A.aInfoCard.push(j)):I.renderNativeInfoWindow(t,c),o.setZIndex_(200),o.setSelected_(!0),o.addCustomClass_("selected"),TNZ.MapUtil.canTrackClick(e)&&(TNZ.EventManager.trigger("TNZ.Map.PinClicked"+T.moduleuniqueid,{unique_id:i,name_key:s}),TNZ.EventManager.trigger("TNZ.Map.ElementClicked",{data:this.extendedData,moduleuniqueid:T.moduleuniqueid}))}),google.maps.event.addListener(o,"mouseout",function(){o.selected||(o.setZIndex_(199),o.setSelected_(!0),o.addCustomClass_("selected"))}),google.maps.event.addListener(o,"mouseover",function(){o.selected||(o.setZIndex_(201),o.setSelected_(!1),o.removeCustomClass_("selected"))})),A.oAllCustomRouteObj[l].markers.push(o),o.setMap(C)})},I.addPolyline=function(e,t){var r=(t=t||{}).unique_id||"-1",o=(t.name_key,t.show_infocard_overlay||!1),l=t.overlay_url||"",a=t.overlap_pan||!1,n=(e=e||[],void 0===t.selectable),i=t.polyline_options||{},s=t.extendedData||{};s.map_type=s.map_type||"spotlight";for(var u=[],c=0;c<e.length;c++){if("string"==typeof e[c])var d=f(e[c]);else d=_(e[c].lat,e[c].lng);u.push(d)}var p=jQuery.extend({},TNZ.MapUtil.getDefaultPolylineOptions(),i);(A.oPolylineOptions=p).uniqueid=t.unique_id,p.path=u,p.extendedData=s;var y=new google.maps.Polyline(p);"-1"!==r&&n&&(google.maps.event.addListener(y,"click",function(e){I.unselectObjectsOnMap(),P()?(w(),o?((j=new Overlay.InfoCard(u[1],O(T.mapholderid),void 0,void 0,{unique_id:r,module_id:T.moduleuniqueid,overlap_pan:a,overlay_url:l})).setMap(C),A.aInfoCard.push(j)):I.renderNativeInfoWindow(y,l)):I.renderNativeInfoWindow(e.latLng,l),I.setPolylineSelStateByID(r,"selected"),I.setItineraryMarkerSelStateByID(r,"selected"),TNZ.MapUtil.canTrackClick(e)&&TNZ.EventManager.trigger("TNZ.Map.ElementClicked",{data:this.extendedData,moduleuniqueid:T.moduleuniqueid})}),google.maps.event.addListener(y,"mouseout",function(){y.selected||(I.setItineraryMarkerSelStateByID(r,"normal"),I.setPolylineSelStateByID(r,"normal"))}),google.maps.event.addListener(y,"mouseover",function(){y.selected||(I.setItineraryMarkerSelStateByID(r,"hover"),I.setPolylineSelStateByID(r,"hover"))})),A.aAllPolylineID.push(r),(A.luAllPolylineObj[r]=y).setMap(C)},I.addItineraryMarkerPin=function(e,t,r){var o=(r=r||{}).unique_id||"-1",l=r.name_key||"",a=r.show_infocard_overlay||!1,n=r.overlap_pan||!0,i=r.overlay_url||"",s=r.icon_namekey||"campervan",u=r.extendedData||{};u.pin_type=u.pin_type||"itinerary",u.map_type=u.map_type||"spotlight",P()||(n=!1);var c=_(e,t),d={url:TNZ.MapUtil.getIconImageFromFile(s),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,10),size:new google.maps.Size(20,20)},p={position:c,icon:d,zIndex:100,selected:!1,extendedData:u,uniqueid:o},y=new google.maps.Marker(p);"-1"!==o&&(google.maps.event.addListener(y,"click",function(e){I.unselectObjectsOnMap(),P()?(w(),a?((j=new Overlay.InfoCard(c,O(T.mapholderid),void 0,void 0,{unique_id:o,module_id:T.moduleuniqueid,overlap_pan:n,overlay_url:i})).setMap(C),A.aInfoCard.push(j)):href.length&&(location.href=href)):I.renderNativeInfoWindow(c,i),I.setPolylineSelStateByID(o,"selected"),I.setItineraryMarkerSelStateByID(o,"selected"),TNZ.MapUtil.canTrackClick(e)&&(TNZ.EventManager.trigger("TNZ.Map.PinClicked"+T.moduleuniqueid,{unique_id:o,name_key:l}),TNZ.EventManager.trigger("TNZ.Map.ElementClicked",{data:this.extendedData,moduleuniqueid:T.moduleuniqueid}))}),google.maps.event.addListener(y,"mouseout",function(){y.selected||(I.setPolylineSelStateByID(o,"normal"),I.setItineraryMarkerSelStateByID(o,"normal"))}),google.maps.event.addListener(y,"mouseover",function(){y.selected||(I.setPolylineSelStateByID(o,"hover"),I.setItineraryMarkerSelStateByID(o,"hover"))})),A.aAllItinMarkerID.push(o),(A.luAllItinMarkerObj[o]=y).setMap(C)},I.addCustomRoute=function(e,t,r,o,l,a,n){n=n||{},e=e||"-1",t=t||[],r=void 0===r||r,o=o||{};var i=jQuery.extend({},TNZ.MapUtil.getDefaultPolylineOptions(),o);if(A.oPolylineOptions=i,1<t.length){if(A.oAllCustomRouteObj[e]={markers:[],directions:"",polyline:"",visible:r},!l)for(var s=0;s<t.length;s++)t[s].options.visible=r,I.addCustomRouteMarkerPin(e,t[s].lat,t[s].lng,t[s].options);var u={origin:t[0].lat+","+t[0].lng,destination:t[t.length-1].lat+","+t[t.length-1].lng,waypoints:[],suppressMarkers:!0,preserveViewport:!0};if(2<t.length)for(s=1;s<t.length-1;s++)u.waypoints.push({location:t[s],stopover:!0});I.generateRouteFromAtoB(u,e,r,o,l,a,n)}},I.hideAllCustomRoutes=function(){for(var e in A.oAllCustomRouteObj)I.toggleCustomRouteVisibility(e,!1)},I.toggleCustomRouteVisibility=function(e,t){var r=A.oAllCustomRouteObj[e];if(void 0!==r){r.visible=t;for(var o=0;o<r.markers.length;o++)t?r.markers[o].show():r.markers[o].hide();r.polyline.setVisible(t)}},I.getVisibleCustomRoutes=function(){var e=A.oAllCustomRouteObj,t={};for(var r in e)e[r].visible&&(t[r]=e[r]);return t},I.removeCustomRoutes=function(){for(var e in A.oAllCustomRouteObj){for(var t=A.oAllCustomRouteObj[e],r=0;r<t.markers.length;r++)t.markers[r].setMap(null);t.polyline&&t.polyline.setMap(null)}A.oAllCustomRouteObj={}},I.renderNativeInfoWindow=function(t,e){var r=e;O.ajax({url:r,data:{},type:"GET",error:function(e,t){},success:function(e){e.error||I.renderNativeInfoWindowWithContent(t,e.value.html)}})},I.renderNativeInfoWindowWithContent=function(e,t,r){if(t.length){var o=(r=r||{}).pixelOffsetY||-40,l=r.pixelOffsetX||0;a.setContent(t),a.setPosition(e),a.setOptions({pixelOffset:new google.maps.Size(l,o)}),a.open(C)}},I.unselectObjectsOnMap=function(){I.unselectActivityMarkers(),I.unselectGroupMarkers(),I.unselectPolylines(),I.unselectItineraryMarkers(),I.unselectCustomRouteMarkers(),I.unselectCustomRoutePolylines()},I.removeCurrentUserLocationMarkerPin=function(){var e=A.currentLocationMarkerObj;null!==e&&(e.setMap(null),A.currentLocationMarkerObj=null)},I.removeTownMarkerPin=function(e){for(var t=A.aAllTownMarkerObj,r=0;r<t.length;r++)if(t[r].uniqueid==e){t[r].setMap(null),t.splice(r,1);break}},I.removeTownMarkerPins=function(){for(var e=A.aAllTownMarkerObj,t=0;t<e.length;t++)e[t].setMap(null);A.aAllTownMarkerObj=[]},I.toggleTownMarkerPinsVisibility=function(e){for(var t=A.aAllTownMarkerObj,r=0;r<t.length;r++)t[r].setVisible(e)},I.removeActivityMarkerPin=function(e){for(var t=A.aAllActMarkerObj,r=0;r<t.length;r++)if(t[r].uniqueid==e){t[r].setMap(null),t.splice(r,1);break}},I.removeActivityMarkerPins=function(){for(var e=A.aAllActMarkerObj,t=0;t<e.length;t++)e[t].setMap(null);A.aAllActMarkerObj=[]},I.getSelectedActivityMarker=function(){for(var e=A.aAllActMarkerObj,t=0;t<e.length;t++)if(e[t].selected)return e[t]},I.unselectActivityMarkers=function(){for(var e=A.aAllActMarkerObj,t=0;t<e.length;t++){e[t].selected=!1;var r=TNZ.MapUtil.getIconImageFromSprite("normal",e[t].iconnamekey,e[t].theme);e[t].setIcon(r),e[t].setAnimation(null)}},I.unselectCustomRouteMarkers=function(){var e=A.oAllCustomRouteObj;for(var t in e)for(var r=0;r<e[t].markers.length;r++)e[t].markers[r].hasOwnProperty("selected")?I.setCustomRouteMidpointMarkerSelStateByID(t,"normal"):(e[t].markers[r].setSelected_(!1),e[t].markers[r].removeCustomClass_("selected"))},I.unselectCustomRoutePolylines=function(){for(var e in A.oAllCustomRouteObj)I.setCustomRoutePolylineSelStateByID(e,"normal")},I.getActivityMarkerByUniqueID=function(e){for(var t=A.aAllActMarkerObj,r=0;r<t.length;r++)if(t[r].uniqueid==e)return t[r]},I.removeGroupMarkerPins=function(){for(var e=A.aAllGroupMarkerObj,t=0;t<e.length;t++)e[t].setMap(null);A.aAllGroupMarkerObj=[]},I.getSelectedGroupMarker=function(){for(var e=A.aAllGroupMarkerObj,t=0;t<e.length;t++)if(e[t].selected)return e[t]},I.unselectGroupMarkers=function(){for(var e=A.aAllGroupMarkerObj,t=0;t<e.length;t++){e[t].selected=!1;var r=TNZ.MapUtil.getIconImageFromFile(e[t].iconnamekey);e[t].setIcon(r),e[t].setAnimation(null)}},I.setupMarkerClustering=function(e){if(T.enablemarkerclusterer){e=e||[];b=new MarkerClusterer(C,e,TNZ.MapUtil.getDefaultMarkerClusterOptions())}},I.clearMarkerClusters=function(){b&&b.clearMarkers()},I.removePolylines=function(){var e=A.luAllPolylineObj;for(var t in e)e[t].setMap(null);A.aAllPolylineID=[],A.luAllPolylineObj={}},I.unselectPolylines=function(){for(var e=A.aAllPolylineID,t=0;t<e.length;t++)A.luAllPolylineObj.hasOwnProperty(e[t])&&I.setPolylineSelStateByID(e[t],"normal")},I.setPolylineSelStateByID=function(e,t){if(A.luAllPolylineObj.hasOwnProperty(e))switch(t){case"normal":A.luAllPolylineObj[e].selected=!1,A.luAllPolylineObj[e].set("zIndex","100"),A.luAllPolylineObj[e].set("strokeColor",A.oPolylineOptions.strokeColor),A.luAllPolylineObj[e].set("strokeWeight","4");break;case"selected":A.luAllPolylineObj[e].set("zIndex","200"),A.luAllPolylineObj[e].selected=!0,A.luAllPolylineObj[e].set("strokeColor","#fc7244"),A.luAllPolylineObj[e].set("strokeWeight","4.5");break;case"hover":A.luAllPolylineObj[e].selected=!1,A.luAllPolylineObj[e].set("zIndex","250"),A.luAllPolylineObj[e].set("strokeColor",A.oPolylineOptions.strokeHoverColor),A.luAllPolylineObj[e].set("strokeWeight","4.5");break;default:A.luAllPolylineObj[e].set("zIndex","100"),A.luAllPolylineObj[e].set("strokeColor",A.oPolylineOptions.strokeColor)}},I.togglePolylineVisibility=function(e,t){A.luAllPolylineObj.hasOwnProperty(e)&&A.luAllPolylineObj[e].setVisible(t)},I.togglePolylineItinMarkerCardVisibility=function(e,t){I.togglePolylineVisibility(e,t),I.toggleItineraryMarkerVisibility(e,t),I.removeInfoCard(),A.luAllItinMarkerObj.hasOwnProperty(e)&&t&&I.triggerObjectClick(A.luAllItinMarkerObj[e])},I.removeItineraryMarkers=function(){A.aAllItinMarkerID=[],A.luAllItinMarkerObj={}},I.unselectItineraryMarkers=function(){for(var e=A.aAllItinMarkerID,t=0;t<e.length;t++)A.luAllItinMarkerObj.hasOwnProperty(e[t])&&I.setItineraryMarkerSelStateByID(e[t],"normal")},I.setItineraryMarkerSelStateByID=function(e,t){if(!A.luAllItinMarkerObj.hasOwnProperty(e))return!1;var r={url:TNZ.MapUtil.getIconImageFromFile("campervan"),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,10),size:new google.maps.Size(20,20)};switch(t){case"normal":A.luAllItinMarkerObj[e].selected=!1,r.url=TNZ.MapUtil.getIconImageFromFile("campervan");break;case"selected":A.luAllItinMarkerObj[e].selected=!0,r.url=TNZ.MapUtil.getIconImageFromFile("campervan-selected");break;case"hover":A.luAllItinMarkerObj[e].selected=!1,r.url=TNZ.MapUtil.getIconImageFromFile("campervan-hover");break;default:r.url=TNZ.MapUtil.getIconImageFromFile("campervan")}A.luAllItinMarkerObj[e].setIcon(r)},I.toggleItineraryMarkerVisibility=function(e,t){A.luAllItinMarkerObj.hasOwnProperty(e)&&A.luAllItinMarkerObj[e].setVisible(t)},I.removeLabels=function(){for(var e=A.aAllLabelObj,t=0;t<e.length;t++)e[t].setMap(null);A.aAllLabelObj=[]},I.toggleLabelVisibility=function(e){for(var t=A.aAllLabelObj,r=0;r<t.length;r++)e?t[r].show():t[r].hide()},I.hideAllLabelObjsExcept=function(e){for(var t=A.aAllLabelObj,r=0;r<t.length;r++)t[r].customcssclass_!=e&&t[r].hide()},I.removeHTMLMarkers=function(){for(var e=A.aAllHTMLMarkerObj,t=0;t<e.length;t++)e[t].setMap(null);A.aAllHTMLMarkerObj=[]},I.getAllActivityMarkerObj=function(){return A.aAllActMarkerObj},I.getAllTownMarkerObj=function(){return A.aAllTownMarkerObj},I.getAllHTMLMarkerObj=function(){return A.aAllHTMLMarkerObj},I.getAllGroupMarkerObj=function(){return A.aAllGroupMarkerObj},I.getAllLabelObj=function(){return A.aAllLabelObj},I.getAllLatLngObj=function(){return A.aAllLatLngObj},I.getAllPolylineObj=function(){for(var e=[],t=A.aAllPolylineID,r=0;r<t.length;r++)A.luAllPolylineObj.hasOwnProperty(t[r])&&e.push(A.luAllPolylineObj[t[r]]);return e},I.getAllItinMarkerObj=function(){for(var e=[],t=A.aAllItinMarkerID,r=0;r<t.length;r++)A.luAllItinMarkerObj.hasOwnProperty(t[r])&&e.push(A.luAllItinMarkerObj[t[r]]);return e},I.getAllCustomRouteObj=function(){return A.oAllCustomRouteObj},I.getAllMarkers=function(e){void 0===e&&(e=!0);var t=I.getAllActivityMarkerObj();t=(t=(t=(t=t.concat(I.getAllTownMarkerObj())).concat(I.getAllHTMLMarkerObj())).concat(I.getAllLatLngObj())).concat(I.getAllItinMarkerObj());var r=I.getAllCustomRouteObj();for(var o in r)t=t.concat(r[o].markers);return e&&(t=t.concat(I.getAllLabelObj())),t},I.getDirectionsService=function(){return 0==T.enabledirectionservice&&alert("Direction service is not enabled in settings"),e},I.getDirectionsRenderer=function(){return 0==T.enabledirectionservice&&alert("Direction service is not enabled in settings"),t},I.generateRouteFromAtoB=function(l,a,e,n,i,s,u){a=a||-1,u=u||{};l.origin=l.origin||"",l.waypoints=l.waypoints||[],l.travelMode=l.travelMode||"DRIVING",l.destination=l.destination||"",l.suppressMarkers=void 0!==l.suppressMarkers&&l.suppressMarkers,l.preserveViewport=void 0!==l.preserveViewport&&l.preserveViewport,(n=n||{}).strokeColor=n.strokeColor||"#666666",n.strokeOpacity=n.strokeOpacity||.9,n.strokeWeight=n.strokeWeight||5,n.visible=void 0===n.visible||n.visible;var t={};t.origin=l.origin,t.waypoints=l.waypoints,t.destination=l.destination,t.travelMode=google.maps.TravelMode[l.travelMode.toUpperCase()];var c={detail:"",success:!(t.optimizeWaypoints=!0),distance:0,timetaken:0,hasFerry:!1};if(!t.origin.length||!t.destination.length)return c;var r=I.getDirectionsService();A.oAllCustomRouteObj[a]=A.oAllCustomRouteObj[a]||{markers:[]},r.route(t,function(e,t){if(t==google.maps.DirectionsStatus.OK){var r=e.routes[0],o=r.legs[0];l.suppressMarkers||(I.addActivityMarkerPin(o.start_location.lat(),o.start_location.lng(),{icon_image_override:TNZ.MapUtil.getIconImageFromFile("start")}),I.addActivityMarkerPin(o.end_location.lat(),o.end_location.lng(),{icon_image_override:TNZ.MapUtil.getIconImageFromFile("end")})),I.renderDirectionsPolylines(e,a,n,i,s,u),l.preserveViewport||I.fitAllObjectsInBound(),c.success=!0,c.detail=o.distance.text+" "+o.duration.text,c.distance=o.distance.value,c.timetaken=o.duration.value,c.hasFerry=d(r),TNZ.EventManager.trigger("Map.Directions.Ready"+T.moduleuniqueid,c)}else TNZ.EventManager.trigger("Map.Directions.Failed"+T.moduleuniqueid,{response:e,status:t})})},I.renderDirectionsPolylines=function(e,r,t,o,l,a){var n=(a=a||{}).overlay_url||"";(l=l||{}).map_type=l.map_type||"spotlight",l.pin_type=l.pin_type||"custom-route",t.path=[],t.extendedData=O.extend({},l)||{},t.extendedData.element_type=t.extendedData.element_type||"route";var i=new google.maps.Polyline(t);if(i.setPath(e.routes[0].overview_path),A.oAllCustomRouteObj[r].polyline=i,o){var s=i.getPath().getArray(),u=Math.ceil(s.length/2);I.addCustomRouteMidpointMarkerPin(r,s[u].lat(),s[u].lng(),{collectionData:a,extendedData:l})}t.selectable&&google.maps.event.addListener(i,"click",function(e){var t=A.oAllCustomRouteObj[r].markers[0];I.unselectObjectsOnMap(),w(),I.renderCard(!0,t,r,n),I.setCustomRoutePolylineSelStateByID(r,"selected"),I.setCustomRouteMidpointMarkerSelStateByID(r,"selected"),TNZ.MapUtil.canTrackClick(e)&&TNZ.EventManager.trigger("TNZ.Map.ElementClicked",{data:this.extendedData,moduleuniqueid:T.moduleuniqueid})}),i.setMap(C)},I.addCustomRouteMidpointMarkerPin=function(r,e,t,o){var l=(o=o||{}).unique_id||r,a=o.name_key||"",n=o.show_infocard_overlay||!0,i=o.overlap_pan||!0,s=o.collectionData||{},u=s.overlay_url||"",c=s.icon_namekey||"car",d=o.extendedData||{};d.pin_type=d.pin_type||"custom-route",d.map_type=d.map_type||"spotlight",P()||(i=!1);var p={position:_(e,t),icon:TNZ.MapUtil.getIconImageFromSprite("normal",c),iconnamekey:c,zIndex:100,selected:!1,uniqueid:l,overlay_url:u,extendedData:d},y=new google.maps.Marker(p);google.maps.event.addListener(y,"click",function(e){var t=A.oAllCustomRouteObj[r].markers[0];I.unselectObjectsOnMap(),w(),I.renderCard(n,t,r,u,i),I.setCustomRoutePolylineSelStateByID(r,"selected"),I.setCustomRouteMidpointMarkerSelStateByID(r,"selected"),TNZ.MapUtil.canTrackClick(e)&&(TNZ.EventManager.trigger("TNZ.Map.PinClicked"+T.moduleuniqueid,{unique_id:l,name_key:a}),TNZ.EventManager.trigger("TNZ.Map.ElementClicked",{data:this.extendedData,moduleuniqueid:T.moduleuniqueid}))}),A.oAllCustomRouteObj[r].markers.push(y),y.setMap(C)},I.setCustomRouteMidpointMarkerSelStateByID=function(e,t){if(!A.oAllCustomRouteObj.hasOwnProperty(e))return!1;if(!A.oAllCustomRouteObj[e].markers.length)return!1;var r=A.oAllCustomRouteObj[e].markers[0];switch(t){case"selected":r.selected=!0;var o=TNZ.MapUtil.getIconImageFromSprite("selected",r.iconnamekey);break;case"hover":r.selected=!1;o=TNZ.MapUtil.getIconImageFromSprite("hover",r.iconnamekey);break;case"normal":default:r.selected=!1;o=TNZ.MapUtil.getIconImageFromSprite("normal",r.iconnamekey)}r.setIcon(o)},I.setCustomRoutePolylineSelStateByID=function(e,t){if(A.oAllCustomRouteObj.hasOwnProperty(e)&&"object"==typeof A.oAllCustomRouteObj[e].polyline)switch(t){case"normal":A.oAllCustomRouteObj[e].polyline.selected=!1,A.oAllCustomRouteObj[e].polyline.set("zIndex","100"),A.oAllCustomRouteObj[e].polyline.set("strokeColor",A.oPolylineOptions.strokeColor),A.oAllCustomRouteObj[e].polyline.set("strokeWeight","4");break;case"selected":A.oAllCustomRouteObj[e].polyline.set("zIndex","200"),A.oAllCustomRouteObj[e].polyline.selected=!0,A.oAllCustomRouteObj[e].polyline.set("strokeColor","#fc7244"),A.oAllCustomRouteObj[e].polyline.set("strokeWeight","4.5");break;case"hover":A.oAllCustomRouteObj[e].polyline.selected=!1,A.oAllCustomRouteObj[e].polyline.set("zIndex","250"),A.oAllCustomRouteObj[e].polyline.set("strokeColor",A.oPolylineOptions.strokeHoverColor),A.oAllCustomRouteObj[e].polyline.set("strokeWeight","4.5");break;default:A.oAllCustomRouteObj[e].polyline.set("zIndex","100"),A.oAllCustomRouteObj[e].polyline.set("strokeColor",A.oPolylineOptions.strokeColor)}},I.getDistanceMatrixService=function(){return 0==T.enabledistancematrixservice&&alert("Distance matrix service is not enabled in settings"),o},I.getDistanceMatrix=function(e,a){var n=e||{};n.origins=n.origins||"",n.destinations=n.destinations||[],n.travelMode=n.travelMode||"DRIVING",n.travelMode=google.maps.TravelMode[n.travelMode.toUpperCase()],n.transitOptions=n.transitOptions||{},n.unitSystem=n.unitSystem||"METRIC",n.unitSystem=google.maps.TravelMode[n.unitSystem.toUpperCase()]||google.maps.UnitSystem.METRIC;var i={success:!1,results:{target_unique_id:-1,distance:-1,duration:-1}};i.orderOfResultsToUpdateTargetsUniqueIds=a||[],i.travelMode=n.travelMode,I.getDistanceMatrixService().getDistanceMatrix(n,function(e,t){if(t==google.maps.DirectionsStatus.OK){(i={success:!0,results:{}}).orderOfResultsToUpdateTargetsUniqueIds=a||[],i.travelMode=n.travelMode;var r={},o="";if(e.rows.length)for(var l in e.rows[0].elements)o=i.orderOfResultsToUpdateTargetsUniqueIds[l],"OK"==e.rows[0].elements[l].status&&(r={target_unique_id:o,distance:e.rows[0].elements[l].distance.text,duration:e.rows[0].elements[l].duration.text,travelMode:i.travelMode},i.results[o]=r)}TNZ.EventManager.trigger("Map.DistanceMatrix.Result"+T.moduleuniqueid,i)})},I.setupPlacesAutocomplete=function(r,e,t){t=void 0===t?"nz":t;e||(e=[]);var o=document.getElementById(r);l[r]={},l[r].autocomplete=new google.maps.places.Autocomplete(o),l[r].autocomplete.setTypes(e),t.length&&l[r].autocomplete.setComponentRestrictions({country:t}),l[r].autocomplete.addListener("place_changed",function(){var e=l[r].autocomplete.getPlace(),t={latitude:-1,longitude:-1,success:!1};e.geometry&&(t.success=!0,t.latitude=e.geometry.location.lat(),t.longitude=e.geometry.location.lng()),TNZ.EventManager.trigger("Map.Places.Autocomplete.Result"+T.moduleuniqueid,t)})},I.getElevationService=function(){return 0==T.enableelevationservice&&alert("Elevation service is not enabled in settings"),n},I.getCurrentMapObj=function(){return C},I.getCenter=function(){return C.getCenter()},I.setCenter=function(e,t){e=e||TNZ.MapCoreConfig.getDefaultCentre().lat,t=t||TNZ.MapCoreConfig.getDefaultCentre().lng;var r=_(e,t);C.setCenter(r)},I.setCenterByLatLngObject=function(e){C.setCenter(e)},I.getZoom=function(){return C.getZoom()},I.setZoom=function(e){C.setZoom(e)},I.resizeMapTrigger=function(){google.maps.event.trigger(C,"resize")},I.panTo=function(e){C.panTo(e)},I.panBy=function(e,t){C.panBy(e,t)},I.panMarkerObjectToCenter=function(e){C.panTo(e.getPosition())},I.getBounds=function(){return r},I.fitBounds=function(e){C.fitBounds(e||r)},I.getBoundsByZoom=function(e,t){var r=C.getProjection();if(r){var o=O(T.mapholderid),l=2*Math.pow(2,e),a=parseInt(o.css("width"))/l,n=parseInt(o.css("height"))/l,i=r.fromLatLngToPoint(t||C.getCenter());return new google.maps.LatLngBounds(r.fromPointToLatLng(new google.maps.Point(i.x-a,i.y+n)),r.fromPointToLatLng(new google.maps.Point(i.x+a,i.y-n)))}},I.fitBoundsByZoom=function(e,t){r=I.getBoundsByZoom(e,t),I.fitBounds(r)},I.extendBound=function(e){r.extend(e)},I.resetBound=function(){r=new google.maps.LatLngBounds},I.fitAllObjectsInBound=function(){I.getBounds();var e=I.getAllActivityMarkerObj(),t=I.getAllTownMarkerObj(),r=I.getAllPolylineObj(),o=I.getAllCustomRouteObj();if(e.length||t.length||r.length||Object.keys(o).length){for(var l=0;l<e.length;l++)I.extendBound(e[l].position);for(l=0;l<t.length;l++)I.extendBound(t[l].position);for(l=0;l<r.length;l++)for(var a=r[l].getPath(),n=0;n<a.getLength();n++)I.extendBound(a.getAt(n));for(var i in o){for(l=0;l<o[i].markers.length;l++){var s=o[i].markers[l].hasOwnProperty("getPosition_")?o[i].markers[l].getPosition_():o[i].markers[l].getPosition();I.extendBound(s)}if("object"==typeof o[i].polyline)for(a=o[i].polyline.getPath(),n=0;n<a.getLength();n++)I.extendBound(a.getAt(n))}I.fitBounds()}else I.setCenter(),I.setZoom(6);I.resizeMapTrigger()},I.getProjection=function(){return C.getProjection()},I.triggerObjectClick=function(e){new google.maps.event.trigger(e,"click",{})},I.getLeftMostMarker=function(){var e=I.getAllMarkers(!1);return TNZ.MapUtil.getLeftMostMarker(C,e)},I.getLeftMostActivityMarker=function(){return TNZ.MapUtil.getLeftMostMarker(C,I.getAllActivityMarkerObj())},I.getRightMostActivityMarker=function(){return TNZ.MapUtil.getRightMostMarker(C,I.getAllActivityMarkerObj())},I.getPixelPosOfMarker=function(e){return TNZ.MapUtil.getPixelPosOfMarker(C,e)},I.getCanvas=function(){return O(T.mapholderid)},I.removeInfoCard=function(){for(var e=0;e<A.aInfoCard.length-1;e++)A.aInfoCard[e].setMap(null),A.aInfoCard[e]=null,A.aInfoCard.splice(e,1)},I.removeInfoCards=function(){for(var e=0;e<A.aInfoCard.length;e++)A.aInfoCard[e].setMap(null),A.aInfoCard[e]=null;A.aInfoCard=[]},I.getData=function(){return A};var i,_=function(e,t){return new google.maps.LatLng(e,t)},f=function(e){var t=e.split(",");return new google.maps.LatLng(t[0],t[1])},s=function(){var e=C.getZoom();if(T.preserveDefaultStyles);else switch(e){case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:2!=A.currentStyleSet&&(A.currentStyleSet=2,C.setOptions({styles:TNZ.MapUtil.getStyleThresholdSettingArray()[A.currentStyleSet].styles}),TNZ.EventManager.trigger("TNZ.Map.Zoom.12+"+T.moduleuniqueid));break;default:1!=A.currentStyleSet&&(A.currentStyleSet=1,C.setOptions({styles:TNZ.MapUtil.getStyleThresholdSettingArray()[A.currentStyleSet].styles}),TNZ.EventManager.trigger("TNZ.Map.Zoom.1-11"+T.moduleuniqueid))}},u=function(){for(var e=!1,t=C.getBounds(),r=I.getAllActivityMarkerObj(),o=I.getAllGroupMarkerObj(),l=0;l<r.length;l++)if(t.contains(r[l].position)){e=!0;break}for(l=0;l<o.length;l++)if(t.contains(o[l].position)){e=!0;break}!e&&TNZ.EventManager.trigger("TNZ.Map.MarkersNotFoundInBound"+T.moduleuniqueid,{module_id:T.moduleuniqueid})},c=function(){if(T.overlaycircle.tracktomapcenter&&T.overlaycircle.display&&A.currentLocationOverlayCircle){var e=C.getCenter(),t=_(e.lat(),e.lng());A.currentLocationOverlayCircle.setOptions({center:t})}},w=function(){j&&("function"==typeof T.infocard.onclose?T.infocard.onclose():I.removeInfoCard())},P=function(){return TNZ.MapCoreConfig.isDesktopDevice()},d=function(e){var t,r=!1;for(var o in e.legs)e.legs[o].steps&&(t=p(e.legs[o].steps))&&t.length&&(r=!0);return r},p=function(e){return O.grep(e,function(e,t){return"ferry"==e.maneuver})};i=O(T.mapholderid),C=new google.maps.Map(i.get(0),T.mapoptions),google.maps.event.addListenerOnce(C,"idle",function(){TNZ.JSLib.triggerLoadEvent("TNZ.Map.Google.Ready."+T.moduleuniqueid),TNZ.JSLib.triggerLoadEvent("TNZ.Map.Platform.Ready."+T.moduleuniqueid)}),google.maps.event.addListener(C,"idle",function(){TNZ.EventManager.trigger("TNZ.Map.StoppedMoving"+T.moduleuniqueid),c()}),google.maps.event.addListener(C,"zoom_changed",s),O("#"+T.moduleuniqueid).on("click touchstart",T.mapholderid,function(){TNZ.EventManager.trigger("TNZ.Map.Interacted"+T.moduleuniqueid,{module_id:T.moduleuniqueid})}),google.maps.event.addListener(C,"dragend",u),r=new google.maps.LatLngBounds,a=new google.maps.InfoWindow({zIndex:6e3}),T.enabledirectionservice&&(e=new google.maps.DirectionsService,t=new google.maps.DirectionsRenderer),T.enabledistancematrixservice&&(o=new google.maps.DistanceMatrixService),T.enableplacesapi&&(l={}),T.enableelevationservice&&(n=new google.maps.ElevationService),google.maps.event.addListener(a,"closeclick",function(){TNZ.EventManager.trigger("InfoWindow.Map.Close"+T.moduleuniqueid,{module_id:T.moduleuniqueid})}),T.showcurrentlocation&&TNZ.JSLib.requireLoadEvent([TNZ.GeoLocation.getCurrentPosition()],function(e,t){var r=t["TNZ.GeoLocation.Ready"];r.success&&I.addCurrentUserLocationMarkerPin(r.latitude,r.longitude)}),TNZ.EventManager.bind("Overlay.InfoCard.Close"+T.moduleuniqueid,function(e){I.unselectObjectsOnMap(),"function"==typeof T.infocard.onclose?T.infocard.onclose():I.removeInfoCard()})};